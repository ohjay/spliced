function addCornerPoints(t,i){var n=document.getElementById(i);t[i].push([0,0]),t[i].push([0,n.clientHeight-1]),t[i].push([n.clientWidth-1,0]),t[i].push([n.clientWidth-1,n.clientHeight-1])}function getMidpoints(t,i,n){for(var r,e,o,a,l=[],h=0;h<t.length;++h)r=t[h],e=i[h],o=r[0]*n+e[0]*(1-n),a=r[1]*n+e[1]*(1-n),l.push([o,a]);return l}function runTriangulation(t,i,n){(n=void 0===n||n)&&(addCornerPoints(t,ID_IMG_FROM),addCornerPoints(t,ID_IMG_TO));var r=getMidpoints(t[ID_IMG_FROM],t[ID_IMG_TO],i);return[r,Delaunay.triangulate(r)]}function triangleInterior(t){for(var i=t[0],n=t[1],r=t[2],e=Math.min(i[0],n[0],r[0]),o=Math.max(i[0],n[0],r[0]),a=Math.min(i[1],n[1],r[1]),l=Math.max(i[1],n[1],r[1]),h=[],p=e;p<=o;++p)for(var u=a;u<=l;++u)Delaunay.contains(t,[p,u],0)&&(0==h.length?h=[[p],[u],[1]]:(h[0].push(p),h[1].push(u),h[2].push(1)));return h}function computeAffine(t,i){return math.multiply(i,math.inv(t))}function bilerp(t,i,n,r,e){var o,a,l,h,p,u,c,f,m=[],s=Math.floor(i),M=Math.floor(t),g=i-s,d=t-M;for(h=4*(s*r+M),p=4*(s*r+M+1),u=4*((s+1)*r+M),c=4*((s+1)*r+M+1),f=0;f<3;++f)a=(1-d)*(o=n[h+f])+d*(M<r-1?n[p+f]:o),l=(1-d)*(s<e-1?n[u+f]:o)+d*(M<r-1&&s<e-1?n[c+f]:o),m.push((1-g)*a+g*l);return m}function colorPixel(t,i,n,r,e,o){t[i]=(n[0]*e+r[0]*o).clip(0,255),t[i+1]=(n[1]*e+r[1]*o).clip(0,255),t[i+2]=(n[2]*e+r[2]*o).clip(0,255),t[i+3]=255}function computeMidpointImage(t,i,n,r,e,o,a,l,h,p,u){var c,f,m,s,M,g,d,I,y,v,_,b,D,x,P,A,G,O,z,C,T,F,H,R,W,k=new Array(a*l*4).fill(0),w=i.length,B=[],E=[];for(R=0;R<w;R+=3){if(c=i[R],f=i[R+1],m=i[R+2],s=[e[c],e[f],e[m]],M=[o[c],o[f],o[m]],g=[t[c],t[f],t[m]],B.push(g),d=math.transpose(math.resize(s,[3,3],1)),I=math.transpose(math.resize(M,[3,3],1)),y=math.transpose(math.resize(g,[3,3],1)),v=computeAffine(y,d),_=computeAffine(y,I),E.push([v,_]),0==(b=triangleInterior(g)).length)return!1;for(x=math.multiply(v,b),P=math.multiply(_,b),D=b[0].length,W=0;W<D;++W)A=x[0][W].clip(0,a-1),G=x[1][W].clip(0,l-1),O=P[0][W].clip(0,a-1),z=P[1][W].clip(0,l-1),F=bilerp(A,G,n,a,l),H=bilerp(O,z,r,a,l),C=Math.floor(b[0][W]),colorPixel(k,4*((T=Math.floor(b[1][W]))*a+C),F,H,p,u)}var N=a*l*4;for(R=3;R<N;R+=4)if(0==k[R])for(C=Math.floor(R/4)%a,T=Math.floor(R/4/a),W=0;W<w;++W)if(g=B[W],Delaunay.contains(g,[C,T],.05)){x=math.multiply(E[W][0],[[C],[T],[1]]),P=math.multiply(E[W][1],[[C],[T],[1]]),A=x[0][0].clip(0,a-1),G=x[1][0].clip(0,l-1),O=P[0][0].clip(0,a-1),z=P[1][0].clip(0,l-1),colorPixel(k,R-3,F=bilerp(A,G,n,a,l),H=bilerp(O,z,r,a,l),p,u);break}return k}Number.prototype.clip=function(t,i){return Math.min(Math.max(this,t),i)};