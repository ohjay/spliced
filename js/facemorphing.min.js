function addCornerPoints(t,r){var i=document.getElementById(r);t[r].push([0,0]),t[r].push([0,i.clientHeight-1]),t[r].push([i.clientWidth-1,0]),t[r].push([i.clientWidth-1,i.clientHeight-1])}function getMidpoints(t,r,i){for(var n,e,o,l,a=[],h=0;h<t.length;++h)n=t[h],e=r[h],o=n[0]*i+e[0]*(1-i),l=n[1]*i+e[1]*(1-i),a.push([o,l]);return a}function runTriangulation(t,r,i){(i=void 0===i||i)&&(addCornerPoints(t,ID_IMG_FROM),addCornerPoints(t,ID_IMG_TO));var n=getMidpoints(t[ID_IMG_FROM],t[ID_IMG_TO],r);return[n,Delaunay.triangulate(n)]}function triangleInterior(t){for(var r=t[0],i=t[1],n=t[2],e=Math.min(r[0],i[0],n[0]),o=Math.max(r[0],i[0],n[0]),l=Math.min(r[1],i[1],n[1]),a=Math.max(r[1],i[1],n[1]),h=[],u=e;u<=o;++u)for(var p=l;p<=a;++p)Delaunay.contains(t,[u,p],0)&&(0==h.length?h=[[u],[p],[1]]:(h[0].push(u),h[1].push(p),h[2].push(1)));return h}function computeAffine(t,r){return math.multiply(r,math.inv(t))}function bilerp(t,r,i,n,e){var o,l,a,h,u,p,c,f,m=[],s=Math.floor(r),M=Math.floor(t),g=r-s,d=t-M;for(h=4*(s*n+M),u=4*(s*n+M+1),p=4*((s+1)*n+M),c=4*((s+1)*n+M+1),f=0;f<3;++f)l=(1-d)*(o=i[h+f])+d*(M<n-1?i[u+f]:o),a=(1-d)*(s<e-1?i[p+f]:o)+d*(M<n-1&&s<e-1?i[c+f]:o),m.push((1-g)*l+g*a);return m}function colorPixel(t,r,i,n,e,o){t[r]=(i[0]*e+n[0]*o).clip(0,255),t[r+1]=(i[1]*e+n[1]*o).clip(0,255),t[r+2]=(i[2]*e+n[2]*o).clip(0,255),t[r+3]=255}function computeMidpointImage(t,r,i,n,e,o,l,a,h,u,p){var c,f,m,s,M,g,d,y,I,v,_,b,D,x,P,A,G,O,z,C,T,F,H,R,W,k=new Array(l*a*4).fill(0),w=r.length,B=[],E=[];for(R=0;R<w;R+=3){c=r[R],f=r[R+1],m=r[R+2],s=[e[c],e[f],e[m]],M=[o[c],o[f],o[m]],g=[t[c],t[f],t[m]],B.push(g),d=math.transpose(math.resize(s,[3,3],1)),y=math.transpose(math.resize(M,[3,3],1)),v=computeAffine(I=math.transpose(math.resize(g,[3,3],1)),d),_=computeAffine(I,y),E.push([v,_]);try{b=triangleInterior(g)}catch(t){return console.log(t),!1}if(0==b.length)return!1;for(x=math.multiply(v,b),P=math.multiply(_,b),D=b[0].length,W=0;W<D;++W)A=x[0][W].clip(0,l-1),G=x[1][W].clip(0,a-1),O=P[0][W].clip(0,l-1),z=P[1][W].clip(0,a-1),F=bilerp(A,G,i,l,a),H=bilerp(O,z,n,l,a),C=Math.floor(b[0][W]),colorPixel(k,4*((T=Math.floor(b[1][W]))*l+C),F,H,u,p)}var N=l*a*4;for(R=3;R<N;R+=4)if(0==k[R])for(C=Math.floor(R/4)%l,T=Math.floor(R/4/l),W=0;W<w;++W){g=B[W];try{if(Delaunay.contains(g,[C,T],.05)){x=math.multiply(E[W][0],[[C],[T],[1]]),P=math.multiply(E[W][1],[[C],[T],[1]]),A=x[0][0].clip(0,l-1),G=x[1][0].clip(0,a-1),O=P[0][0].clip(0,l-1),z=P[1][0].clip(0,a-1),colorPixel(k,R-3,F=bilerp(A,G,i,l,a),H=bilerp(O,z,n,l,a),u,p);break}}catch(t){return console.log(t),!1}}return k}Number.prototype.clip=function(t,r){return Math.min(Math.max(this,t),r)};